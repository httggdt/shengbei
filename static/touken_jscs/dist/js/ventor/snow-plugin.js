"use strict";!function(t){function e(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i)}function i(){var t={};for(type in{Top:"",Left:""}){var e="Top"==type?"Y":"X";"undefined"!=typeof window["page"+e+"Offset"]?t[type.toLowerCase()]=window["page"+e+"Offset"]:(e=document.documentElement.clientHeight?document.documentElement:document.body,t[type.toLowerCase()]=e["scroll"+type])}return t}function n(){var t,e=document.body;return window.innerHeight?t=window.innerHeight:e.parentElement.clientHeight?t=e.parentElement.clientHeight:e&&e.clientHeight&&(t=e.clientHeight),t}function a(t){this.parent=document.body,this.createEl(this.parent,t),this.size=5*Math.random()+5,this.el.style.width=Math.round(this.size)+"px",this.el.style.height=Math.round(this.size)+"px",this.maxLeft=document.body.offsetWidth-this.size,this.maxTop=document.body.offsetHeight-this.size,this.left=Math.random()*this.maxLeft,this.top=i().top+1,this.angle=1.4+.2*Math.random(),this.minAngle=1.4,this.maxAngle=1.6,this.angleDelta=.01*Math.random(),this.speed=2+Math.random()}var s=window,o=(setTimeout,function(){var t=document.createElement("canvas");return"function"==typeof t.getContext});window.Snow=function(t,e){!function(){for(var t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=14,n=window.setTimeout(function(){t(i)},i);return n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),this.settings=e,this.flakes=[],this.flakeCount=e.count,this.mx=-100,this.my=-100,this.init(t)},Snow.prototype.init=function(e){this.canvas=e.get(0),this.ctx=this.canvas.getContext("2d"),this.canvas.width=s.innerWidth,this.canvas.height=s.innerHeight,this.flakes=[];for(var i=0;i<this.flakeCount;i++){var n=Math.floor(Math.random()*this.canvas.width),a=Math.floor(Math.random()*this.canvas.height),o=Math.floor(100*Math.random())%this.settings.size+2,h=Math.floor(100*Math.random())%this.settings.speed+Math.random()*o/10+.5,r=.5*Math.random()+this.settings.opacity;this.flakes.push({speed:h,velY:h,velX:0,x:n,y:a,size:o,stepSize:Math.random()/30,step:0,angle:180,opacity:r})}1==this.settings.interaction&&this.canvas.addEventListener("mousemove",function(t){this.mx=t.clientX,this.my=t.client});var l=this;t(s).resize(function(){l.ctx.clearRect(0,0,l.canvas.width,l.canvas.height),l.canvas.width=s.innerWidth,l.canvas.height=s.innerHeight}),"string"==typeof this.settings.image&&(this.image=t("<img src='"+this.settings.image+"' style='display: none'>")),this.snow()},Snow.prototype.snow=function(){var t=this,e=function i(){t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);for(var e=0;e<t.flakeCount;e++){var n=t.flakes[e],a=t.mx,o=t.my,h=100,r=n.x,l=n.y,c=Math.sqrt((r-a)*(r-a)+(l-o)*(l-o));if(h>c){var d=h/(c*c),m=(a-r)/c,f=(o-l)/c,g=d/2;n.velX-=g*m,n.velY-=g*f}else switch(n.velX*=.98,n.velY<=n.speed&&(n.velY=n.speed),t.settings.windPower){case!1:n.velX+=Math.cos(n.step+=.05)*n.stepSize;break;case 0:n.velX+=Math.cos(n.step+=.05)*n.stepSize;break;default:n.velX+=.01+t.settings.windPower/100}if(n.y+=n.velY,n.x+=n.velX,(n.y>=t.canvas.height||n.y<=0)&&t.resetFlake(n),(n.x>=t.canvas.width||n.x<=0)&&t.resetFlake(n),0==t.settings.image){var u=t.ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,n.size-1);u.addColorStop(0,t.settings.startColor),u.addColorStop(1,t.settings.endColor),t.ctx.fillStyle=u,t.ctx.beginPath(),t.ctx.arc(n.x,n.y,n.size,0,2*Math.PI),t.ctx.fill()}else t.ctx.drawImage(t.image.get(0),n.x,n.y,2*n.size,2*n.size)}s.cancelAnimationFrame(i),s.requestAnimationFrame(i)};e()},Snow.prototype.resetFlake=function(t){if(0==this.settings.windPower||0==this.settings.windPower)t.x=Math.floor(Math.random()*this.canvas.width),t.y=0;else if(this.settings.windPower>0){var e=Array(Math.floor(Math.random()*this.canvas.width),0),i=Array(0,Math.floor(Math.random()*this.canvas.height)),n=Array(e,i),a=n[Math.floor(Math.random()*n.length)];t.x=a[0],t.y=a[1]}else{var e=Array(Math.floor(Math.random()*this.canvas.width),0),i=Array(this.canvas.width,Math.floor(Math.random()*this.canvas.height)),n=Array(e,i),a=n[Math.floor(Math.random()*n.length)];t.x=a[0],t.y=a[1]}t.size=Math.floor(100*Math.random())%this.settings.size+2,t.speed=Math.floor(100*Math.random())%this.settings.speed+Math.random()*t.size/10+.5,t.velY=t.speed,t.velX=0,t.opacity=.5*Math.random()+this.settings.opacity},t.fn.snow=function(){var e=o();if(e&&t(this).each(function(e,i){var n={};t.each(i.attributes,function(e,i){n[t.camelCase(i.name)]=Number(Number(i.value))?Number(i.value):i.value}),"string"==typeof n.image&&"false"===n.image&&(n.image=!1),new Snow(t(i),{speed:1,interaction:n.interaction||!0,size:n.size||2,count:n.count||200,opacity:n.opacity||1,startColor:n.startColor||"rgba(255,255,255,1)",endColor:n.endColor||"rgba(255,255,255,0)",windPower:n.windPower||0,image:n.image||!1})}),!e){var i={};t(this).each(function(e,n){i.image=t(n).attr("image")||"./imgs/snow.png",t(this).remove(),c("",40)})}};var h=!0,r=null,l=[],c=function(t,s){clearInterval(r),l=[],r=setInterval(function(){h&&s>l.length&&Math.random()<.0025*s&&l.push(new a(t)),!h&&!l.length&&clearInterval(r);for(var e=i().top,o=n(),c=l.length-1;c>=0;c--)l[c]&&(l[c].top<e||l[c].top+l[c].size+1>e+o?(l[c].remove(),l[c]=null,l.splice(c,1)):(l[c].move(),l[c].draw()))},40),e(window,"scroll",function(){for(var t=l.length-1;t>=0;t--)l[t].draw()})};a.prototype={createEl:function(t,e){this.el=document.createElement("img"),this.el.classname="nicesnowclass",this.el.setAttribute("src",e||"./imgs/snow.png"),this.el.style.position="absolute",this.el.style.display="block",this.el.style.zIndex="99999",this.parent.appendChild(this.el)},move:function(){(this.angle<this.minAngle||this.angle>this.maxAngle)&&(this.angleDelta=-this.angleDelta),this.angle+=this.angleDelta,this.left+=this.speed*Math.cos(this.angle*Math.PI),this.top-=this.speed*Math.sin(this.angle*Math.PI),this.left<0?this.left=this.maxLeft:this.left>this.maxLeft&&(this.left=0)},draw:function(){this.el.style.top=Math.round(this.top)+"px",this.el.style.left=Math.round(this.left)+"px"},remove:function(){this.parent.removeChild(this.el),this.parent=this.el=null}}}(jQuery);